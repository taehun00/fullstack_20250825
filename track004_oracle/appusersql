create table appuser(
    APP_USER_ID NUMBER(5) NOT NULL,
    EMAIL       VARCHAR2(100) NOT NULL,
    PASSWORD    VARCHAR2(100),
    MBTI_TYPE_ID    NUMBER(3),
    CREATED_AT  DATE DEFAULT SYSDATE,
    CONSTRAINT pk_appuser PRIMARY KEY (APP_USER_ID)
);

ALTER TABLE appuser MODIFY created_at DEFAULT SYSDATE;
ALTER TABLE appuser
ADD ufile VARCHAR2(255) DEFAULT 'default.png';


create sequence appuser_seq;

desc appuser;

ALTER TABLE appuser
  ADD (
    MOBILE   VARCHAR2(50),
    NICKNAME VARCHAR2(50)
  );
commit;

select * from appuser;

insert into appuser values (1, 'iis1@naver.com', '123', 1, SYSDATE);
update appuser
set mbti_type_id = 2
where app_user_id=48;
select * from appuser where app_user_id=39;
select * from appuser where email = 'iis1@naver.com';


delete from appuser where app_user_id=26;



update appuser
set email='iis22@naver.com' , password = '1234' , mbti_type_id = 1
where email='iis2@naver.com' and password='123';

desc emp;


create table authorities(
    userid varchar2(100) not null,
    auth   varchar2(100) not null
);
alter table authorities rename column userid to email;

desc authorities;
desc appuser;

select * from appuser;
select * from authorities;
insert into authorities values ('iis1@naver.com', 'MEMBER');

select u.email, u.password, a.auth
from appuser u
join authorities a
on u.email = a.email;

select u.email, u.password, a.auth
from appuser u
left outer join authorities a
on u.email = a.email
where u.email = 'iis1@naver.com';

select u.email, u.password, a.auth
from appuser u
right outer join authorities a
on u.email = a.email
where u.email = 'iis1@naver.com';

select email, password, auth
from appuser
natural join authorities
where email = 'iis1@naver.com';

select email, u.password, a.auth
from appuser u
left outer join authorities a
using(email)
where email = 'iis1@naver.com';

desc sboard1;
select * from sboard1;
insert into sboard1 ( ID    , APP_USER_ID , btitle, bcontent, bpass, bfile,  bip )
      select  sboard1_seq.nextval , APP_USER_ID , btitle, bcontent, bpass, bfile,  bip   from sboard1;
      

select *
from ( select row_number() over ( order by create_at desc ) as rnum,
    id , app_user_id , btitle, bcontent, bpass, bfile, bhit, bip, create_at
    from sboard1
) A
where A.rnum between 1 and 10;
SELECT COUNT(*) FROM users WHERE mobile = '010';
select * from authorities;
select * from users;
select * from pet;
select * from pettype;
desc users;
desc pet;
desc authorities;
delete from authorities;
delete from pet;
delete from users;
commit;
delete from users where userid=111;
UPDATE authorities
SET auth = 'ROLE_ADMIN'
WHERE userId = 122
  AND auth = 'ROLE_MEMBER';
desc pettype;
select * from pettype;
commit;
ALTER TABLE authorities
ADD CONSTRAINT fk_authorities_users
FOREIGN KEY (email)
REFERENCES users(email)
ON DELETE CASCADE;
ALTER TABLE AUTHORITIES
  ADD USERID NUMBER;
ALTER TABLE AUTHORITIES
  DROP CONSTRAINT FK_AUTHORITIES_USERS;
ALTER TABLE AUTHORITIES
  ADD CONSTRAINT FK_AUTHORITIES_USERS
  FOREIGN KEY (USERID)
  REFERENCES USERS(USERID);

SELECT a.constraint_name,
       a.table_name      AS child_table,
       a.column_name     AS child_column,
       c_pk.table_name   AS parent_table,
       c_pk.column_name  AS parent_column
FROM user_cons_columns a
JOIN user_constraints c
  ON a.constraint_name = c.constraint_name
JOIN user_cons_columns c_pk
  ON c.r_constraint_name = c_pk.constraint_name
WHERE c.constraint_type = 'R'   -- R = Referential (FK)
  AND a.table_name = 'AUTHORITIES';

CREATE TABLE AUTHORITIES (
    AUTH    VARCHAR2(100) NOT NULL,
    USERID  NUMBER,
    CONSTRAINT PK_AUTHORITIES PRIMARY KEY (AUTH, USERID),
    CONSTRAINT FK_AUTHORITIES_USERS FOREIGN KEY (USERID)
        REFERENCES USERS (USERID)
);

CREATE TABLE FOODBRAND (
    BRANDID        NUMBER           PRIMARY KEY,
    BRANDNAME      VARCHAR2(100)    NOT NULL,
    COUNTRY        VARCHAR2(100),
    BRANDTYPE      VARCHAR2(50)     NOT NULL,   
    ORIGIN         VARCHAR2(50),             
    BRANDINFO      VARCHAR2(500)

);
CREATE TABLE FOOD (
    FOODID          NUMBER          PRIMARY KEY,
    FOODNAME        VARCHAR2(100)   NOT NULL,
    BRANDID         NUMBER          NOT NULL,
    DESCRIPTION     VARCHAR2(500),
    MAININGREDIENT  VARCHAR2(200)   NOT NULL,
    SUBINGREDIENT   VARCHAR2(200),
    PETTYPEID       NUMBER          NOT NULL,
    CATEGORY        VARCHAR2(50)    NOT NULL,
    PETAGEGROUP     VARCHAR2(50),
    ISGRAINFREE     CHAR(1)         CHECK (UPPER(ISGRAINFREE) IN ('Y','N')),
    CALORIE         NUMBER(5,1),
    FOODTYPE        VARCHAR2(20),
    FOODIMG         VARCHAR2(300),
    CREATEDAT       DATE DEFAULT SYSDATE,
    UPDATEDAT       DATE DEFAULT NULL,

    CONSTRAINT FK_FOOD_BRAND FOREIGN KEY (BRANDID)
        REFERENCES FOODBRAND(BRANDID),

    CONSTRAINT FK_FOOD_PETTYPE FOREIGN KEY (PETTYPEID)
        REFERENCES PETTYPE(PETTYPEID)
);
CREATE SEQUENCE food_seq
START WITH 1 INCREMENT BY 1
NOCACHE;

commit;
select * from authorities;
select * from appuser;
desc authorities;
desc appuser;
delete from appuser;
delete from authorities;
delete from appuser where app_user_id=106 and password='123';
select * from appuser where app_user_id=105;
