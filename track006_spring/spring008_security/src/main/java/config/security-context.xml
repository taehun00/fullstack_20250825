<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:security="http://www.springframework.org/schema/security"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd
		http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-4.2.xsd">
	
	<!-- 암호화 -->
	<bean id="passwordEncoder" 
			class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder"/>

	<!-- 로그인성공시 -->
	<bean id="successHandler" class="com.thejoa703.security.LoginSuccessHandler"/>
	
	<!-- 로그인실패시 -->
	<bean id="deninedHandler" class="com.thejoa703.security.DeniedHandler"/>
	
	<!-- 유저정보 -->
	<bean id="customUserDetailsService" class="com.thejoa703.security.CustomUserDetailsHandler"/>

	<security:http>
       <!-- 디스패처보다 먼저 실행             모든 경로            무제한허가 -->
       <security:intercept-url pattern="/security/all"    access="permitAll"/>
       <security:intercept-url pattern="/security/member" access="hasRole('ROLE_MEMBER')"/>

       
       <!-- 로그인폼 필요 -->
       <security:form-login
       		login-page="/security/login"
       		authentication-success-handler-ref="successHandler"
       		authentication-failure-forward-url="/security/fail"
       		
       />
       <security:logout
	       	logout-url="/security/logout"
	       	logout-success-url="/security/login"
	       	invalidate-session="true"
       />
    </security:http>

   <security:authentication-manager>   
      <!-- provider : 실제 db상에 있는지 비교 -->
      <security:authentication-provider user-service-ref="customUserDetailsService">
         <!-- 유저 정보 가져오기 -->
         <security:password-encoder ref="passwordEncoder"/>
      </security:authentication-provider>
   </security:authentication-manager>
		
</beans>
